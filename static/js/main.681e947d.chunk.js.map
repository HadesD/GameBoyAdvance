{"version":3,"sources":["images/game-boy-advance.svg","components/play/EmulatorManager.js","images/emu-canvas-bg.svg","images/dpad.svg","images/gba-console-landscape.svg","images/emu-background.svg","components/play/lib/gbaninja/VBAGraphics.js","components/play/lib/gbaninja/VBASound.js","components/play/lib/gbaninja/VBAInterface.js","components/BodyScrollUnAble.js","components/withSplashScreen.js","components/Header.js","components/Home.js","components/play/Emulator.js","components/play/Joystick.js","components/play/GamepadManager.js","components/play/KeyboardManager.js","components/Play.js","components/Main.js","components/Footer.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","__webpack_require__","p","EmulatorManager","parent","Object","D_Documents_Git_GameBoyAdvance_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","this","console","log","apiReady","GB","window","amebo","GBA","gbaninja","keyCodes","A","B","SELECT","START","RIGHT","LEFT","UP","DOWN","R","L","pressedKeyList","gameType","rom","codeName","fileName","buffer","emuApi","isPaused","keyboardManager","self","load","concat","process","err","script","error","destroy","key","keyCode","keys","i","length","onReleased","map","v","toString","join","startOffset","endOffset","name","charCode","String","fromCharCode","indexOf","ArrayBuffer","Uint8Array","screen","refs","hasChildNodes","removeChild","lastChild","graphic","document","createElement","appendChild","isGBRom","keyConfig","keyMapConfig","loadROMBuffer","isGBARom","VBAInterface","emulatorManager","setRomBuffer","getRomName","start","url","hRequest","XMLHttpRequest","open","responseType","onload","e","send","fileObj","reader","FileReader","target","result","loadRomBuffer","loadRomZipFile","readAsArrayBuffer","unzip","Zlib","Unzip","Buffer","fileNames","getFilenames","decompress","keyType","updateKeyState","value","keysArray","util","compileShader","gl","shaderSource","shaderType","shader","createShader","getShaderParameter","COMPILE_STATUS","Error","getShaderInfoLog","createProgram","vertexShader","fragmentShader","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","createShaderFromScript","scriptId","opt_shaderType","shaderScript","getElementById","text","type","VERTEX_SHADER","FRAGMENT_SHADER","createProgramFromScripts","vertexShaderId","fragmentShaderId","createTexture","size","texture","bindTexture","TEXTURE_2D","tempPixels","Uint16Array","texImage2D","RGBA","UNSIGNED_SHORT_5_5_5_1","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","updateTexture","width","height","pixels","texSubImage2D","createFullscreenQuad","lower","upper","fullscreenQuadBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","GBA_WIDTH","GBA_HEIGHT","VBAGraphics","emscriptenModule","canvas","totalFrames","lastFrameTime","performance","now","shaderProgram","positionLocation","textureSamplerLocation","prototype","create","constructor","initScreen","getContext","alpha","getAttribLocation","getUniformLocation","drawGBAFrame","gbaPointer8","hasRequestedFrameButNotRendered","gbaPointer16","gbaHeap16","HEAP16","drawFrame","useProgram","enableVertexAttribArray","vertexAttribPointer","FLOAT","activeTexture","TEXTURE0","uniform1i","drawArrays","TRIANGLES","onResize","clientWidth","clientHeight","viewport","VBASound","audioCtx","AudioContext","audioChannels","audioScriptNode","createScriptProcessor","onaudioprocess","handleAudioEvent","bind","connect","destination","audioSpareSamplesRingBuffer","Int16Array","audioSpareWritePtr","audioSpareReadPtr","spareSamplesAtLastEvent","addEventListener","evt","source","createBufferSource","IE_VBASound","getSampleRate","sampleRate","currentAudioTime","currentTime","getNumExtraSamples","samples","resetSound","writeSound","pointer8","length16","pointer16","heap16","event","VBA_get_emulating","channel","audioBuffers","numChannels","outputBuffer","numberOfChannels","requiredSamples","push","getChannelData","Date","wasmEmu","vbaGraphics","GBA_CYCLES_PER_SECOND","animationFrameRequest","update","deltaTime","clampedDeltaTime","Math","min","cyclesToDo","floor","vbaSound","VBA_do_cycles","requestAnimationFrame","romBuffer8","ccall","VBA_start","cycles","VBA_stop","VBA_get_bios","VBA_get_rom","VBA_get_internalRAM","VBA_get_workRAM","VBA_get_paletteRAM","VBA_get_vram","VBA_get_pix","VBA_get_oam","VBA_get_ioMem","VBA_get_systemColorMap16","VBA_get_systemColorMap32","VBA_get_systemFrameSkip","VBA_set_systemFrameSkip","n","VBA_get_systemSaveUpdateCounter","VBA_reset_systemSaveUpdateCounter","VBA_emuWriteBattery","VBA_agbPrintFlush","NYI","feature","getAudioSampleRate","getRomSize","startPointer8","byteLength","copyRomToMemory","gbaHeap8","HEAP8","renderFrame","pixPointer8","initSound","pauseSound","resumeSound","setThrottleSound","getSaveSize","commitFlash","commitEeprom","restoreSaveMemory","targetBufferSize","isKeyDown","isKeyPressed","getJoypad","joypadNum","res","dbgOutput","textPointer8","unknownPointer8","cancelAnimationFrame","BodyScrollUnAble","props","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","lastTouchEnd","onContextMenu","assertThisInitialized","onScroll","scrollTo","disableBodyScroll","querySelector","removeEventListener","clearAllBodyScrollLocks","touches","preventDefault","scale","className","react_default","a","ref","style","children","React","Component","LoadingMessage","layout","position","backgroundColor","textAlign","components_BodyScrollUnAble","top","left","marginTop","marginBottom","src","alt","maxWidth","imgWidth","marginRight","bottom","spin","withSplashScreen","WrappedComponent","_React$Component2","_class","state","loading","inherits","createClass","_componentDidMount","asyncToGenerator","regenerator_default","mark","_callee","_this2","wrap","_context","prev","next","setTimeout","setState","stop","apply","arguments","withSplashScreen_LoadingMessage","Header","pathName","location","pathname","lineHeight","menu","theme","selectedKeys","mode","Item","Link","to","icon","verticalAlign","GbaIcon","withRouter","Home","Emulator","onClick","onDrop","onDragOver","inputFileOnChange","file","dataTransfer","files","loadRomFile","inputFile","click","backgroundImage","emuCanvasBKG","id","accept","display","onChange","Joystick","isPushed","hasSupportTouch","documentElement","selfRef","createRef","emulatorRef","onMouseDown","onMouseMove","onMouseUp","current","getAttribute","onPressed","posX","clientX","posY","clientY","touchedKeyList","touch","elementFromPoint","touchPos","changedTouches","releaseAllKey","joykey","isActive","btns","getElementsByTagName","btn","classList","add","remove","data-joykey","dpadIcon","GamepadManager","gamepads","rafId","scanIntervalId","selectedIndex","parentRef","onGamepadConnected","onGamepadDisconnected","scanGamepads","setInterval","clearInterval","gamepad","buttons","val","isPressed","pressed","navigator","getGamepads","index","addGamepad","axes","KeyboardManager","onKeyDown","onKeyUp","pushedList","find","elm","joystickRef","setActive","getJoykey","setActiveJoykey","Play","gamePadManager","updateWindowDimensions","timeOut","clearTimeout","innerWidth","innerHeight","contains","gbaLandscape","emuBKG","play_Emulator","components_play_Joystick","Main","Content","Route","exact","path","component","Footer","components_Header","components_Footer","components_Main","Boolean","hostname","match","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","mozCancelAnimationFrame","webkitAudioContext","webkitGamepads","webkitGetGamepads","ReactDOM","render","BrowserRouter","basename","src_App_0","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.681e947d.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/game-boy-advance.ddd93e7f.svg\";","import { Zlib } from 'zlibjs/bin/unzip.min';\r\nimport load from 'load-script';\r\n\r\nimport VBAInterface from './lib/gbaninja/VBAInterface';\r\n\r\nclass EmulatorManager\r\n{\r\n  constructor(parent)\r\n  {\r\n    console.log('EmulatorManager.constructor called');\r\n\r\n    this.parent = parent;\r\n\r\n    this.apiReady = {\r\n      GB: window.amebo ? true : false,\r\n      GBA: window.gbaninja ? true : false,\r\n    };\r\n\r\n    // Main key codes\r\n    // keyCode<KeyType, Code>\r\n    this.keyCodes = {\r\n      A: 1,\r\n      B: 2,\r\n      SELECT: 3,\r\n      START: 4,\r\n      RIGHT: 5,\r\n      LEFT: 6,\r\n      UP: 7,\r\n      DOWN: 8,\r\n      R: 9,\r\n      L: 10,\r\n    };\r\n    this.pressedKeyList = {};\r\n\r\n    this.gameType = {\r\n      GB: 1,\r\n      GBA: 2,\r\n    };\r\n\r\n    this.rom = {\r\n      codeName: null, // Name in ROM OFFSET\r\n      fileName: null,\r\n      gameType: null, // GB / GBA\r\n      buffer: null,\r\n    };\r\n\r\n    this.emuApi = null;\r\n\r\n    this.isPaused = true;\r\n  }\r\n\r\n  start()\r\n  {\r\n    this.keyboardManager = this.parent.parent.keyboardManager;\r\n\r\n    const self = this;\r\n\r\n    if (!this.apiReady.GB)\r\n    {\r\n      load(`${process.env.PUBLIC_URL}/lib/amebo.js`, function(err, script) {\r\n        if (err)\r\n        {\r\n          console.error(err);\r\n          return;\r\n        }\r\n        self.apiReady.GB = true;\r\n      });\r\n    }\r\n\r\n    if (!this.apiReady.GBA)\r\n    {\r\n      load(`${process.env.PUBLIC_URL}/lib/gbaninja.js`, function(err, script) {\r\n        if (err)\r\n        {\r\n          console.error(err);\r\n          return;\r\n        }\r\n        self.apiReady.GBA = true;\r\n      });\r\n    }\r\n  }\r\n\r\n  destroy()\r\n  {\r\n    if (this.emuApi)\r\n    {\r\n      this.emuApi.destroy();\r\n    }\r\n  }\r\n\r\n  isKeyPressed(key)\r\n  {\r\n    const keyCode = this.keyCodes[key];\r\n    if (!keyCode)\r\n    {\r\n      return false;\r\n    }\r\n    return this.pressedKeyList[keyCode];\r\n  }\r\n\r\n  releaseAllKey()\r\n  {\r\n    const keys = Object.keys(this.keyCodes);\r\n    for (let i = 0; i < keys.length; i++)\r\n    {\r\n      this.onReleased(keys[i]);\r\n    }\r\n  }\r\n\r\n  isGBRom(buffer)\r\n  {\r\n    let gbMagic = [\r\n      buffer[0x0104], buffer[0x0105], buffer[0x0106], buffer[0x0107],\r\n      buffer[0x0108], buffer[0x0109], buffer[0x010A], buffer[0x010B],\r\n    ].map(function (v) {\r\n      return v.toString(16);\r\n    }).join();\r\n    return (gbMagic === 'ce,ed,66,66,cc,d,0,b');\r\n  }\r\n\r\n  getRomName() {\r\n    const isGBA = (this.rom.gameType === this.gameType.GBA);\r\n    const startOffset = isGBA ? 0xA0 : 0x134;\r\n    const endOffset = startOffset + 16;\r\n    let name = '';\r\n    for (let i = startOffset; i < endOffset; i++)\r\n    {\r\n      const charCode = this.rom.buffer[i];\r\n      if ((charCode === 0x80) || (charCode === 0xC0) || (charCode === 0x0))\r\n      {\r\n        break;\r\n      }\r\n      name += String.fromCharCode(charCode);\r\n    }\r\n    return name;\r\n  }\r\n\r\n  isGBARom(buffer)\r\n  {\r\n    return true;\r\n  }\r\n\r\n  loadRomBuffer(buffer)\r\n  {\r\n    if (this.rom.fileName.indexOf('.gb') === -1)\r\n    {\r\n      return;\r\n    }\r\n\r\n    this.rom.buffer = (buffer instanceof ArrayBuffer) ? (new Uint8Array(buffer)) : buffer;\r\n\r\n    this.destroy();\r\n\r\n    const screen = this.parent.refs.screen;\r\n    while (screen.hasChildNodes())\r\n    {\r\n      screen.removeChild(screen.lastChild);\r\n    }\r\n    const graphic = document.createElement('canvas');\r\n    screen.appendChild(graphic);\r\n\r\n    if (this.isGBRom(this.rom.buffer))\r\n    {\r\n      this.rom.gameType = this.gameType.GB;\r\n\r\n      this.emuApi = new window.amebo(graphic);\r\n      this.emuApi.keyConfig = this.keyboardManager.keyMapConfig;\r\n      this.emuApi.loadROMBuffer(this.rom.buffer);\r\n    }\r\n    else if (this.isGBARom(buffer))\r\n    {\r\n      this.rom.gameType = this.gameType.GBA;\r\n\r\n      this.emuApi = new VBAInterface(graphic);\r\n      this.emuApi.emulatorManager = this;\r\n      this.emuApi.setRomBuffer(this.rom.buffer);\r\n    }\r\n\r\n    this.rom.codeName = this.getRomName();\r\n\r\n    this.emuApi.start();\r\n\r\n    this.isPaused = false;\r\n\r\n    console.log(this.rom);\r\n  }\r\n\r\n  loadRomUrl(url)\r\n  {\r\n    const hRequest = new XMLHttpRequest();\r\n    hRequest.open('GET', url);\r\n    hRequest.responseType = 'arraybuffer';\r\n    hRequest.onload = function(e) {\r\n      console.log(e);\r\n      // this.rom.fileName = fileName;\r\n    };\r\n    hRequest.send();\r\n  }\r\n\r\n  // Like input.type=\"file\" / drag|drop.file\r\n  loadRomFile(fileObj)\r\n  {\r\n    const self = this;\r\n    const reader = new FileReader();\r\n    reader.onload = function(e) {\r\n      const buffer = e.target.result;\r\n      if (fileObj.name.indexOf('.zip') !== -1)\r\n      {\r\n        self.loadRomZipFile(buffer);\r\n        return;\r\n      }\r\n\r\n      self.rom.fileName = fileObj.name;\r\n      self.loadRomBuffer(buffer);\r\n    };\r\n    reader.readAsArrayBuffer(fileObj);\r\n  }\r\n\r\n  // Buffer is Zip file ArrayBuffer\r\n  loadRomZipFile(buffer)\r\n  {\r\n    const unzip = new Zlib.Unzip(new Buffer(buffer));\r\n    const fileNames = unzip.getFilenames();\r\n    for (let i = 0; i < fileNames.length; i++)\r\n    {\r\n      const fileName = fileNames[i];\r\n      if (fileName.indexOf('.gb') !== -1)\r\n      {\r\n        this.rom.fileName = fileName;\r\n        this.loadRomBuffer(unzip.decompress(fileName));\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  onPressed(keyType)\r\n  {\r\n    if (this.isPaused)\r\n    {\r\n      return;\r\n    }\r\n\r\n    const key = this.keyCodes[keyType];\r\n    if (!key)\r\n    {\r\n      return;\r\n    }\r\n    this.pressedKeyList[key] = true;\r\n\r\n    console.log('onPressed: %s', keyType);\r\n\r\n    this.updateKeyState(keyType, this.pressedKeyList[key]);\r\n  }\r\n\r\n  onReleased(keyType)\r\n  {\r\n    if (this.isPaused)\r\n    {\r\n      return;\r\n    }\r\n\r\n    const key = this.keyCodes[keyType];\r\n    if (!key)\r\n    {\r\n      return;\r\n    }\r\n    this.pressedKeyList[key] = false;\r\n\r\n    console.log('onRelease: %s', keyType);\r\n\r\n    this.updateKeyState(keyType, this.pressedKeyList[key]);\r\n  }\r\n\r\n  // Update for each emulator\r\n  updateKeyState(keyType, value)\r\n  {\r\n    switch (this.rom.gameType)\r\n    {\r\n      case this.gameType.GB: {\r\n        this.emuApi.keysArray[this.keyboardManager.keyMapConfig[keyType]] = value ? 0 : 1;\r\n        break;\r\n      }\r\n      case this.gameType.GBA: {\r\n\r\n        break;\r\n      }\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n\r\n  pause()\r\n  {\r\n    this.isPaused = true;\r\n  }\r\n}\r\n\r\nexport default EmulatorManager;\r\n\r\n","module.exports = __webpack_public_path__ + \"static/media/emu-canvas-bg.2a9ac588.svg\";","module.exports = __webpack_public_path__ + \"static/media/dpad.296e73f9.svg\";","module.exports = __webpack_public_path__ + \"static/media/gba-console-landscape.a7b93da5.svg\";","module.exports = __webpack_public_path__ + \"static/media/emu-background.0371e715.svg\";","var util = {\r\n  compileShader: function (gl, shaderSource, shaderType) {\r\n    var shader = gl.createShader(shaderType);\r\n    gl.shaderSource(shader, shaderSource);\r\n    gl.compileShader(shader);\r\n    var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n    if (!success) {\r\n      throw new Error(\"could not compile shader:\" + gl.getShaderInfoLog(shader));\r\n    }\r\n    return shader;\r\n  },\r\n\r\n  createProgram: function (gl, vertexShader, fragmentShader) {\r\n    var program = gl.createProgram();\r\n    gl.attachShader(program, vertexShader);\r\n    gl.attachShader(program, fragmentShader);\r\n    gl.linkProgram(program);\r\n    var success = gl.getProgramParameter(program, gl.LINK_STATUS);\r\n    if (!success) {\r\n      throw new Error(\"program filed to link:\" + gl.getProgramInfoLog (program));\r\n    }\r\n    return program;\r\n  },\r\n\r\n  createShaderFromScript: function (gl, scriptId, opt_shaderType) {\r\n    // look up the script tag by id.\r\n    var shaderScript = document.getElementById(scriptId);\r\n    var shaderSource = shaderScript.text;\r\n    if (!opt_shaderType) {\r\n      if (shaderScript.type === \"x-shader/x-vertex\") {\r\n        opt_shaderType = gl.VERTEX_SHADER;\r\n      } else if (shaderScript.type === \"x-shader/x-fragment\") {\r\n        opt_shaderType = gl.FRAGMENT_SHADER;\r\n      } else {\r\n        throw new Error(\"Unreachable\");\r\n      }\r\n    }\r\n    return this.compileShader(gl, shaderSource, opt_shaderType);\r\n  },\r\n\r\n  createProgramFromScripts: function (gl, vertexShaderId, fragmentShaderId) {\r\n    var vertexShader = this.createShaderFromScript(gl, vertexShaderId);\r\n    var fragmentShader = this.createShaderFromScript(gl, fragmentShaderId);\r\n    return this.createProgram(gl, vertexShader, fragmentShader);\r\n  },\r\n\r\n  createTexture: function (gl, size) {\r\n    var texture = gl.createTexture();\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    var tempPixels = new Uint16Array(size * size);\r\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, size, size, 0, gl.RGBA, gl.UNSIGNED_SHORT_5_5_5_1, tempPixels);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n    return texture;\r\n  },\r\n\r\n  updateTexture: function (gl, texture, width, height, pixels) {\r\n    gl.bindTexture(gl.TEXTURE_2D, texture);\r\n    gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0,\r\n      width, height, gl.RGBA, gl.UNSIGNED_SHORT_5_5_5_1, pixels);\r\n  },\r\n\r\n  createFullscreenQuad: function  (gl, lower, upper) {\r\n    var fullscreenQuadBuffer = gl.createBuffer();\r\n    gl.bindBuffer(gl.ARRAY_BUFFER, fullscreenQuadBuffer);\r\n    gl.bufferData(\r\n      gl.ARRAY_BUFFER,\r\n      new Float32Array([\r\n        lower,    lower,\r\n        upper,    lower,\r\n        lower,    upper,\r\n        lower,    upper,\r\n        upper,    lower,\r\n        upper,    upper]),\r\n      gl.STATIC_DRAW);\r\n    return fullscreenQuadBuffer;\r\n  },\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nvar GBA_WIDTH = 240;\r\nvar GBA_HEIGHT = 160;\r\nvar TEXTURE_SIZE = 256;\r\n\r\nfunction VBAGraphics (emscriptenModule, canvas) {\r\n  this.emscriptenModule = emscriptenModule;\r\n  this.canvas = canvas;\r\n\r\n  this.totalFrames = 0;\r\n  this.lastFrameTime = window.performance.now();\r\n\r\n  // Webgl assets\r\n  this.gl = null;\r\n  this.fullscreenQuadBuffer = null;\r\n  this.texture = null;\r\n  this.shaderProgram = null;\r\n  this.positionLocation = null;\r\n  this.textureSamplerLocation = null;\r\n\r\n  // Temporary buffer to store pixels as they're being\r\n  // sub'd into the texture.\r\n  this.pixels = new Uint16Array(GBA_WIDTH * GBA_HEIGHT);\r\n\r\n}\r\nVBAGraphics.prototype = Object.create(Object.prototype);\r\nVBAGraphics.prototype.constructor = VBAGraphics;\r\n\r\nVBAGraphics.prototype.initScreen = function () {\r\n\r\n  // Get webgl\r\n  this.gl = this.canvas.getContext(\"webgl\", {alpha: false}) ||\r\n    this.canvas.getContext(\"experimental-webgl\", {alpha: false});\r\n\r\n  if (!this.gl) {\r\n    return false;\r\n  }\r\n\r\n  // Set up assets\r\n  this.shaderProgram = util.createProgramFromScripts(this.gl, \"2d-vertex-shader\", \"2d-fragment-shader\");\r\n  this.texture = util.createTexture(this.gl, TEXTURE_SIZE);\r\n  this.fullscreenQuadBuffer = util.createFullscreenQuad(this.gl, 0, 1);\r\n\r\n  // Get locations\r\n  this.positionLocation = this.gl.getAttribLocation(this.shaderProgram, \"a_position\");\r\n  this.textureSamplerLocation = this.gl.getUniformLocation(this.shaderProgram, \"u_sampler\");\r\n\r\n  return true;\r\n};\r\n\r\n\r\n\r\nVBAGraphics.prototype.drawGBAFrame = function  (gbaPointer8) {\r\n\r\n  // var deltaTime = window.performance.now() - this.lastFrameTime;\r\n  // vbaPerf.renderDeadlineResultsThisSecond.push(window.hasRequestedFrameButNotRendered);\r\n  window.hasRequestedFrameButNotRendered = false;\r\n  this.lastFrameTime = window.performance.now();\r\n\r\n  var gbaPointer16 = gbaPointer8 / 2;\r\n  var gbaHeap16 = this.emscriptenModule.HEAP16;\r\n  for (var i = 0; i < this.pixels.length; i++) {\r\n    this.pixels[i] = gbaHeap16[gbaPointer16 + i];\r\n  }\r\n  util.updateTexture(this.gl, this.texture, GBA_WIDTH, GBA_HEIGHT, this.pixels);\r\n  this.drawFrame();\r\n  this.totalFrames++;\r\n};\r\n\r\nVBAGraphics.prototype.drawFrame = function  () {\r\n\r\n  // Bind shader\r\n  this.gl.useProgram(this.shaderProgram);\r\n\r\n  // Bind verts\r\n  this.gl.bindBuffer(this.gl.ARRAY_BUFFER, this.fullscreenQuadBuffer);\r\n  this.gl.enableVertexAttribArray(this.positionLocation);\r\n  this.gl.vertexAttribPointer(this.positionLocation, 2, this.gl.FLOAT, false, 0, 0);\r\n\r\n  // Bind texture\r\n  this.gl.activeTexture(this.gl.TEXTURE0);\r\n  this.gl.bindTexture(this.gl.TEXTURE_2D, this.texture);\r\n  this.gl.uniform1i(this.textureSamplerLocation, 0);\r\n\r\n  // Draw\r\n  this.gl.drawArrays(this.gl.TRIANGLES, 0, 6);\r\n\r\n};\r\n\r\n\r\n\r\nVBAGraphics.prototype.onResize = function (/*windowWidth, windowHeight*/) {\r\n  var canvas = this.canvas;\r\n  //        canvas.style.top = canvas.style.bottom = canvas.style.left = canvas.style.right = \"0\";\r\n  //        canvas.style.width = \"\";\r\n  //        canvas.style.height = \"\";\r\n  //\r\n  //        var aspect = GBA_WIDTH / GBA_HEIGHT;\r\n  //\r\n  //        if (windowWidth < windowHeight * aspect) {\r\n  //            // Change width\r\n  //            var offset = (windowHeight - (windowWidth / aspect)) / 2;\r\n  //            canvas.style.top = canvas.style.bottom = offset + \"px\";\r\n  //            canvas.style.width = \"100%\";\r\n  //        }\r\n  //        if (windowHeight < windowWidth / aspect) {\r\n  //            // Change height\r\n  //            var offset = (windowWidth - (windowHeight * aspect)) / 2;\r\n  //            canvas.style.left = canvas.style.right = offset + \"px\";\r\n  //            canvas.style.height = \"100%\";\r\n  //        }\r\n  canvas.width = canvas.clientWidth;\r\n  canvas.height = canvas.clientHeight;\r\n  this.gl.viewport(0, 0, canvas.width, canvas.height);\r\n};\r\n\r\nVBAGraphics.prototype.destroy = function() {\r\n\r\n};\r\n\r\nexport default VBAGraphics;\r\n\r\n","function VBASound(emscriptenModule) {\r\n\r\n  this.emscriptenModule = emscriptenModule;\r\n\r\n  // window.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n  this.audioCtx = new window.AudioContext();\r\n  this.audioChannels = 2;\r\n  this.audioScriptNode = this.audioCtx.createScriptProcessor(512, 2);\r\n  this.audioScriptNode.onaudioprocess = this.handleAudioEvent.bind(this);\r\n  this.audioScriptNode.connect(this.audioCtx.destination);\r\n  this.audioSpareSamplesRingBuffer = new Int16Array(1024 * 16);\r\n  this.audioSpareWritePtr = 0;\r\n  this.audioSpareReadPtr = 0;\r\n  this.spareSamplesAtLastEvent = 0;\r\n\r\n  const self = this;\r\n\r\n  // Support IOS\r\n  window.addEventListener('touchstart', function(evt) {\r\n    const buffer = self.audioCtx.createBuffer(1, 1, 22050);\r\n    const source = self.audioCtx.createBufferSource();\r\n    source.buffer = buffer;\r\n\r\n    source.connect(self.audioCtx.destination);\r\n    source.start(0);\r\n  }, false);\r\n}\r\n\r\nVBASound.prototype = Object.create(Object.prototype);\r\nVBASound.prototype.constructor = VBASound;\r\n\r\nVBASound.prototype.getSampleRate = function () {\r\n  return this.audioCtx.sampleRate;\r\n};\r\n\r\nVBASound.prototype.currentAudioTime = function () {\r\n  return this.audioCtx.currentTime;\r\n};\r\n\r\nVBASound.prototype.getNumExtraSamples = function () {\r\n  var samples = this.audioSpareWritePtr - this.audioSpareReadPtr;\r\n  return samples >= 0 ? samples : (samples + this.audioSpareSamplesRingBuffer.length);\r\n};\r\n\r\nVBASound.prototype.resetSound = function () {\r\n};\r\n\r\nVBASound.prototype.writeSound = function (pointer8, length16) {\r\n  // console.log(1);\r\n\r\n  if (pointer8 % 2 === 1) {\r\n    console.error(\"Audio pointer must be 16 bit aligned.\");\r\n    return;\r\n  }\r\n  if (length16 % 2 !== 0) {\r\n    console.error(\"Number of audio samples must be even.\");\r\n    return;\r\n  }\r\n  var pointer16 = pointer8 >> 1;\r\n  var heap16 = this.emscriptenModule.HEAP16;\r\n  var i;\r\n\r\n  for (i = 0; i < length16; i++) {\r\n    this.audioSpareSamplesRingBuffer[this.audioSpareWritePtr] = heap16[pointer16 + i];\r\n    this.audioSpareWritePtr++;\r\n    if (this.audioSpareWritePtr >= this.audioSpareSamplesRingBuffer.length) {\r\n      this.audioSpareWritePtr = 0;\r\n    }\r\n  }\r\n\r\n  // console.log('write.sound');\r\n\r\n};\r\n\r\nVBASound.prototype.handleAudioEvent = function (event) {\r\n\r\n  // console.log(event);\r\n  if (!window.gbaninja || !window.VBAInterface || !window.VBAInterface.VBA_get_emulating()) {\r\n    return;\r\n  }\r\n\r\n  var audioBuffers = [];\r\n  var numChannels = event.outputBuffer.numberOfChannels;\r\n  var requiredSamples = event.outputBuffer.length;\r\n  // var deadlineResult = 1; // Hit\r\n  var i, channel;\r\n\r\n  for (i = 0; i < numChannels; i++) {\r\n    audioBuffers.push(event.outputBuffer.getChannelData(i));\r\n  }\r\n\r\n  for (i = 0; i < requiredSamples; i++) {\r\n    for (channel = 0; channel < numChannels; channel++) {\r\n      if (this.audioSpareReadPtr === this.audioSpareWritePtr) {\r\n        audioBuffers[channel][i] = 0;\r\n        // deadlineResult = 0; // Miss\r\n      } else {\r\n        audioBuffers[channel][i] = this.audioSpareSamplesRingBuffer[this.audioSpareReadPtr] / 0x4000;\r\n        this.audioSpareReadPtr++;\r\n        if (this.audioSpareReadPtr >= this.audioSpareSamplesRingBuffer.length) {\r\n          this.audioSpareReadPtr -= this.audioSpareSamplesRingBuffer.length;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  this.spareSamplesAtLastEvent = this.getNumExtraSamples();\r\n};\r\n\r\n// Implementation for browsers without audio support\r\nfunction IE_VBASound(emscriptenModule) {\r\n  this.emscriptenModule = emscriptenModule;\r\n}\r\nIE_VBASound.prototype = Object.create(Object.prototype);\r\nIE_VBASound.prototype.constructor = IE_VBASound;\r\n\r\nIE_VBASound.prototype.getSampleRate = function () {\r\n  return 44100;\r\n};\r\n\r\nIE_VBASound.prototype.currentAudioTime = function () {\r\n  return Date.now() / 1000;\r\n};\r\n\r\nIE_VBASound.prototype.getNumExtraSamples = function () {\r\n  return 0;\r\n};\r\n\r\nIE_VBASound.prototype.resetSound = function () {\r\n};\r\n\r\nIE_VBASound.prototype.writeSound = function () {\r\n};\r\n\r\nIE_VBASound.prototype.handleAudioEvent = function () {\r\n};\r\n\r\nexport default VBASound;\r\n\r\n","import VBAGraphics from './VBAGraphics';\r\nimport VBASound from './VBASound';\r\n\r\nfunction VBAInterface(graphic)\r\n{\r\n  const wasmEmu = window.gbaninja;\r\n  window.VBAInterface = this;\r\n\r\n  this.vbaGraphics = new VBAGraphics(wasmEmu, graphic);\r\n\r\n  const GBA_CYCLES_PER_SECOND = 16777216;\r\n  // var TARGET_FRAMERATE = 500;\r\n  let lastFrameTime = window.performance.now();\r\n  // window.frameTimeout = null;\r\n  let animationFrameRequest = null;\r\n  // window.frameNum = 1;\r\n  // window.lastFocusTime = 0;\r\n  const self = this;\r\n\r\n  const gbaninja = wasmEmu;\r\n\r\n  this.setRomBuffer = function(buffer) {\r\n    this.romBuffer8 = buffer;\r\n  };\r\n\r\n  this.VBA_get_emulating = function () {\r\n    return gbaninja.ccall(\"VBA_get_emulating\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_start = function () {\r\n    return gbaninja.ccall(\"VBA_start\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_do_cycles = function (cycles) {\r\n    return gbaninja.ccall(\"VBA_do_cycles\", \"int\", [\"int\"], [cycles]);\r\n  };\r\n\r\n  this.VBA_stop = function () {\r\n    return gbaninja.ccall(\"VBA_stop\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_bios = function () {\r\n    return gbaninja.ccall(\"VBA_get_bios\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_rom = function () {\r\n    return gbaninja.ccall(\"VBA_get_rom\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_internalRAM = function () {\r\n    return gbaninja.ccall(\"VBA_get_internalRAM\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_workRAM = function () {\r\n    return gbaninja.ccall(\"VBA_get_workRAM\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_paletteRAM = function () {\r\n    return gbaninja.ccall(\"VBA_get_paletteRAM\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_vram = function () {\r\n    return gbaninja.ccall(\"VBA_get_vram\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_pix = function () {\r\n    return gbaninja.ccall(\"VBA_get_pix\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_oam = function () {\r\n    return gbaninja.ccall(\"VBA_get_oam\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_ioMem = function () {\r\n    return gbaninja.ccall(\"VBA_get_ioMem\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_systemColorMap16 = function () {\r\n    return gbaninja.ccall(\"VBA_get_systemColorMap16\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_systemColorMap32 = function () {\r\n    return gbaninja.ccall(\"VBA_get_systemColorMap32\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_get_systemFrameSkip = function () {\r\n    return gbaninja.ccall(\"VBA_get_systemFrameSkip\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_set_systemFrameSkip = function (n) {\r\n    return gbaninja.ccall(\"VBA_set_systemFrameSkip\", \"int\", [\"int\"], [n]);\r\n  };\r\n\r\n  this.VBA_get_systemSaveUpdateCounter = function () {\r\n    return gbaninja.ccall(\"VBA_get_systemSaveUpdateCounter\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_reset_systemSaveUpdateCounter = function () {\r\n    return gbaninja.ccall(\"VBA_reset_systemSaveUpdateCounter\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_emuWriteBattery = function () {\r\n    return gbaninja.ccall(\"VBA_emuWriteBattery\", \"int\", [], []);\r\n  };\r\n\r\n  this.VBA_agbPrintFlush = function () {\r\n    return gbaninja.ccall(\"VBA_agbPrintFlush\", \"int\", [], []);\r\n  };\r\n\r\n  // ------- VBA EXIT POINTS --------\r\n\r\n  this.NYI = function (feature) {\r\n    console.log(\"Feature is NYI: \", feature);\r\n  };\r\n\r\n  this.getAudioSampleRate = function () {\r\n    return this.vbaSound.getSampleRate();\r\n  };\r\n\r\n  this.getRomSize = function (startPointer8) {\r\n    return this.romBuffer8.byteLength;\r\n  };\r\n\r\n  this.copyRomToMemory = function (startPointer8) {\r\n    var gbaHeap8 = gbaninja.HEAP8;\r\n    var byteLength = this.romBuffer8.byteLength;\r\n    for (var i = 0; i < byteLength; i++) {\r\n      gbaHeap8[startPointer8 + i] = this.romBuffer8[i];\r\n    }\r\n  };\r\n\r\n  this.renderFrame = function (pixPointer8) {\r\n    this.vbaGraphics.drawGBAFrame(pixPointer8);\r\n  };\r\n\r\n  this.initSound = function () {\r\n  };\r\n\r\n  this.pauseSound = function () {\r\n  };\r\n\r\n  this.resetSound = function () {\r\n    this.vbaSound.resetSound();\r\n  };\r\n\r\n  this.resumeSound = function () {\r\n  };\r\n\r\n  this.writeSound = function (pointer8, length16) {\r\n    return this.vbaSound.writeSound(pointer8, length16);\r\n  };\r\n\r\n  this.setThrottleSound = function (pointer8, length16) {\r\n  };\r\n\r\n  this.getSaveSize = function () {\r\n    return 0;\r\n    // return vbaSaves.getSaveSize();\r\n  };\r\n\r\n  this.commitFlash = this.commitEeprom = function (pointer8, size) {\r\n    return 0;\r\n    // return vbaSaves.softCommit(pointer8, size);\r\n  };\r\n\r\n  this.restoreSaveMemory = function (pointer8, targetBufferSize) {\r\n    return 0;\r\n    // return vbaSaves.restoreSaveMemory(pointer8, targetBufferSize);\r\n  };\r\n\r\n  this.isKeyDown = function (key) {\r\n    return this.emulatorManager.isKeyPressed(key);\r\n  };\r\n\r\n  this.getJoypad = function (joypadNum) {\r\n    var res = 0;\r\n\r\n    if (this.isKeyDown('A')) {\r\n      res |= 1;\r\n    }\r\n    if (this.isKeyDown('B')) {\r\n      res |= 2;\r\n    }\r\n    if (this.isKeyDown('SELECT')) {\r\n      res |= 4;\r\n    }\r\n    if (this.isKeyDown('START')) {\r\n      res |= 8;\r\n    }\r\n    if (this.isKeyDown('RIGHT')) {\r\n      res |= 16;\r\n    }\r\n    if (this.isKeyDown('LEFT')) {\r\n      res |= 32;\r\n    }\r\n    if (this.isKeyDown('UP')) {\r\n      res |= 64;\r\n    }\r\n    if (this.isKeyDown('DOWN')) {\r\n      res |= 128;\r\n    }\r\n    if (this.isKeyDown('R')) {\r\n      res |= 256;\r\n    }\r\n    if (this.isKeyDown('L')) {\r\n      res |= 512;\r\n    }\r\n\r\n    // disallow L+R or U+D from being pressed at the same time\r\n    if ((res & 48) === 48) {\r\n      res &= ~48;\r\n    }\r\n    if ((res & 192) === 192) {\r\n      res &= ~192;\r\n    }\r\n\r\n    // return vbaInput.getJoypad(joypadNum);\r\n    return res;\r\n  };\r\n\r\n  this.dbgOutput = function (textPointer8, unknownPointer8) {\r\n    return console.log(\"dbgOutput\", textPointer8, unknownPointer8);\r\n  };\r\n\r\n  // Do step\r\n  function update()\r\n  {\r\n    const currentTime = window.performance.now();\r\n    const deltaTime = currentTime - lastFrameTime;\r\n\r\n    // console.log(currentTime, deltaTime);\r\n\r\n    if (deltaTime >= 0.1)\r\n    {\r\n      const clampedDeltaTime = Math.min(50, deltaTime);\r\n\r\n      let cyclesToDo = Math.floor(GBA_CYCLES_PER_SECOND / (1000 / clampedDeltaTime));\r\n      if (self.vbaSound.spareSamplesAtLastEvent > 1000) {\r\n        cyclesToDo -= Math.floor(Math.min(cyclesToDo * 0.03, GBA_CYCLES_PER_SECOND / 10000));\r\n      }\r\n      if (self.vbaSound.spareSamplesAtLastEvent < 700) {\r\n        cyclesToDo += Math.floor(Math.min(cyclesToDo * 0.03, GBA_CYCLES_PER_SECOND / 10000));\r\n      }\r\n\r\n      self.VBA_do_cycles(cyclesToDo);\r\n      lastFrameTime = currentTime;\r\n    }\r\n\r\n    animationFrameRequest = window.requestAnimationFrame(update);\r\n  }\r\n\r\n  this.start = function () {\r\n    if (!this.vbaGraphics.initScreen())\r\n    {\r\n      console.error('You need to enable WebGL!');\r\n      return;\r\n    }\r\n    this.vbaGraphics.drawFrame();\r\n\r\n    this.vbaSound = new VBASound(window.gbaninja);\r\n\r\n    this.VBA_start();\r\n\r\n    animationFrameRequest = window.requestAnimationFrame(update);\r\n  }\r\n\r\n  this.destroy = function () {\r\n    window.cancelAnimationFrame(animationFrameRequest);\r\n    this.VBA_stop();\r\n    window.VBAInterface = null;\r\n  }\r\n}\r\n\r\nexport default VBAInterface;\r\n\r\n","import React from 'react';\r\nimport { disableBodyScroll/* , enableBodyScroll */, clearAllBodyScrollLocks } from 'body-scroll-lock';\r\n\r\nclass BodyScrollUnAble extends React.Component\r\n{\r\n  lastTouchEnd = 0;\r\n\r\n  constructor(props)\r\n  {\r\n    super(props);\r\n\r\n    // this.touchstartHandle.bind(this);\r\n    // this.touchendHandle.bind(this);\r\n    // this.touchmoveHandle.bind(this);\r\n    this.onContextMenu = this.onContextMenu.bind(this);\r\n    this.onScroll = this.onScroll.bind(this);\r\n  }\r\n\r\n  componentDidMount()\r\n  {\r\n    // document.addEventListener('touchstart', this.touchstartHandle, true);\r\n    // document.addEventListener('touchmove', this.touchmoveHandle, true);\r\n    // document.addEventListener('touchend', this.touchendHandle, true);\r\n\r\n    window.scrollTo(0, 0);\r\n    disableBodyScroll(document.querySelector('#root'));\r\n\r\n    document.addEventListener('contextmenu', this.onContextMenu);\r\n    window.addEventListener('scroll', this.onScroll);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    // document.removeEventListener('touchstart', this.touchstartHandle, true);\r\n    // document.removeEventListener('touchmove', this.touchmoveHandle, true);\r\n    // document.removeEventListener('touchend', this.touchendHandle, true);\r\n    document.removeEventListener('contextmenu', this.onContextMenu);\r\n    window.removeEventListener('scroll', this.onScroll);\r\n\r\n    clearAllBodyScrollLocks();\r\n  }\r\n\r\n  touchstartHandle(event)\r\n  {\r\n    if (event.touches.length > 1)\r\n    {\r\n      event.preventDefault();\r\n    }\r\n  }\r\n\r\n  touchmoveHandle(event)\r\n  {\r\n    if (event.scale !== 1) { event.preventDefault(); }\r\n  }\r\n\r\n  // touchendHandle(event)\r\n  // {\r\n  //   var now = window.performance.now();\r\n  //   if ((now - this.lastTouchEnd) <= 500) {\r\n  //     event.preventDefault();\r\n  //   }\r\n  //   this.lastTouchEnd = now;\r\n  // }\r\n\r\n  onContextMenu(e)\r\n  {\r\n    e.preventDefault();\r\n  }\r\n\r\n  onScroll(e)\r\n  {\r\n    // e.preventDefault();\r\n    window.scrollTo(0, 0);\r\n  }\r\n\r\n  render()\r\n  {\r\n    const className = [\r\n      'noselect',\r\n      this.props.className ? this.props.className : ''\r\n    ].join(' ');\r\n    return (\r\n      <div\r\n        ref={this.props.ref ? this.props.ref : false}\r\n        className={className}\r\n        style={this.props.style ? this.props.style : {}}\r\n      >\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default BodyScrollUnAble;\r\n\r\n","import React from 'react';\r\nimport {\r\n  Layout,\r\n  Spin\r\n} from 'antd';\r\nimport BodyScrollUnAble from './BodyScrollUnAble';\r\n\r\nclass LoadingMessage extends React.Component\r\n{\r\n  render()\r\n  {\r\n    const imgWidth = 100;\r\n    return (\r\n      <Layout style={{ position: 'relative', height: '100vh', backgroundColor: 'transparent', textAlign: 'center' }}>\r\n        <BodyScrollUnAble>\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              width: '100%',\r\n              top: '50%',\r\n              left: 0,\r\n              marginTop: '-' + ((imgWidth + 10 + 22)/2) + 'px'\r\n            }}\r\n          >\r\n            <div style={{ marginBottom: '10px' }}>\r\n              <img\r\n                src=\"favicon.ico\"\r\n                alt=\"Splash logo\"\r\n                style={{ maxWidth: imgWidth + 'px', }}\r\n              />\r\n            </div>\r\n            <div className=\"ant-tag\" style={{ marginRight: 0 }}>\r\n              GameBoy Advance\r\n            </div>\r\n          </div>\r\n          <div style={{ position: 'absolute', width: '100%', bottom: '100px', left: 0 }}>\r\n            <Spin />\r\n          </div>\r\n        </BodyScrollUnAble>\r\n      </Layout>\r\n    );\r\n  }\r\n}\r\n\r\nfunction withSplashScreen(WrappedComponent) {\r\n  return class extends React.Component {\r\n    constructor(props) {\r\n      super(props);\r\n      this.state = {\r\n        loading: true,\r\n      };\r\n    }\r\n\r\n    async componentDidMount() {\r\n      try {\r\n        setTimeout(() => {\r\n          this.setState({\r\n            loading: false,\r\n          });\r\n        }, 1500);\r\n      } catch (err) {\r\n        console.log(err);\r\n        this.setState({\r\n          loading: false,\r\n        });\r\n      }\r\n    }\r\n\r\n    render() {\r\n      if (this.state.loading)\r\n      {\r\n        return (\r\n          <LoadingMessage />\r\n        );\r\n      }\r\n\r\n      return (\r\n        <WrappedComponent {...this.props} />\r\n      );\r\n    }\r\n  };\r\n}\r\n\r\nexport default withSplashScreen;\r\n\r\n","import React, { Component } from 'react';\r\nimport {\r\n  Link,\r\n  withRouter\r\n} from 'react-router-dom';\r\nimport { Layout, Menu, Icon } from 'antd';\r\n\r\nimport GbaIcon from '../images/game-boy-advance.svg';\r\n\r\nclass Header extends Component\r\n{\r\n  render()\r\n  {\r\n    const pathName = this.props.location.pathname;\r\n    return (\r\n      <Layout.Header style={{ height:'inherit',lineHeight:'inherit' }}>\r\n        <Menu\r\n          theme=\"dark\"\r\n          selectedKeys={[pathName]}\r\n          mode=\"horizontal\"\r\n          style={{ lineHeight: pathName === '/play' ? '25px' : '46px' }}\r\n        >\r\n          <Menu.Item key=\"/\">\r\n            <Link to=\"/\">\r\n              <Icon type=\"home\" />Home\r\n            </Link>\r\n          </Menu.Item>\r\n          <Menu.Item key=\"/play\">\r\n            <Link to=\"/play\">\r\n              <i className=\"anticon\" style={{ verticalAlign: 'text-top', width: '22px' }}>\r\n                <img src={GbaIcon} alt=\"Play\" />\r\n              </i>\r\n              Play\r\n            </Link>\r\n          </Menu.Item>\r\n        </Menu>\r\n      </Layout.Header>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(Header);\r\n\r\n","import React, { Component } from 'react';\r\n\r\nclass Home extends Component\r\n{\r\n  render()\r\n  {\r\n    return (\r\n      <div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Home;\r\n\r\n","import React from 'react';\r\n\r\nimport EmulatorManager from './EmulatorManager';\r\n\r\nimport emuCanvasBKG from '../../images/emu-canvas-bg.svg';\r\n\r\nclass Emulator extends React.Component\r\n{\r\n  constructor(props)\r\n  {\r\n    console.log('Emulator.constructor called');\r\n    super(props);\r\n\r\n    this.parent = props.parent;\r\n\r\n    this.emulatorManager = new EmulatorManager(this);\r\n\r\n    this.onClick = this.onClick.bind(this);\r\n    this.onDrop = this.onDrop.bind(this);\r\n    this.onDragOver = this.onDragOver.bind(this);\r\n    this.inputFileOnChange = this.inputFileOnChange.bind(this);\r\n  }\r\n\r\n  componentDidMount()\r\n  {\r\n    this.emulatorManager.start();\r\n  }\r\n\r\n  componentWillUnmount()\r\n  {\r\n    console.log('Emulator.componentWillUnmount');\r\n\r\n    this.emulatorManager.destroy();\r\n  }\r\n\r\n  onDragOver(e)\r\n  {\r\n    e.preventDefault();\r\n  }\r\n\r\n  onDrop(e)\r\n  {\r\n    e.preventDefault();\r\n    const file = e.dataTransfer.files[0];\r\n    if (!file)\r\n    {\r\n      return;\r\n    }\r\n\r\n    this.emulatorManager.loadRomFile(file);\r\n  }\r\n\r\n  onClick(e)\r\n  {\r\n    e.preventDefault();\r\n    this.refs.inputFile.click();\r\n  }\r\n\r\n  inputFileOnChange(e)\r\n  {\r\n    e.preventDefault();\r\n    const file = e.target.files[0];\r\n    if (!file)\r\n    {\r\n      return;\r\n    }\r\n    this.emulatorManager.loadRomFile(file);\r\n  }\r\n\r\n  render()\r\n  {\r\n    return (\r\n      <div\r\n        className=\"emu-wrapper\"\r\n        style={{\r\n          backgroundImage: 'url('+emuCanvasBKG+')',\r\n        }}\r\n      >\r\n        <script id=\"2d-vertex-shader\" type=\"x-shader/x-vertex\">\r\n          {`\r\n            attribute vec2 a_position;\r\n            varying highp vec2 v_textureCoord;\r\n\r\n            void main() {\r\n              /**\r\n               * This scales the quad so that the screen texture fits the viewport.\r\n               * The texture is 256 * 256, but only 240 * 160 is used. The quad is 2*2, centered on (0,0)\r\n               */\r\n              gl_Position = vec4((a_position.x * 2.0 * 1.0666) - 1.0, (a_position.y * 2.0 * 1.6) * -1.0 + 1.0, 0, 1);\r\n              v_textureCoord = vec2(a_position.x, a_position.y);\r\n            }\r\n            `}\r\n        </script>\r\n        <script id=\"2d-fragment-shader\" type=\"x-shader/x-fragment\">\r\n          {`\r\n          varying highp vec2 v_textureCoord;\r\n\r\n          uniform sampler2D u_sampler;\r\n\r\n          void main(void) {\r\n            gl_FragColor = texture2D(u_sampler, vec2(v_textureCoord.s, v_textureCoord.t));\r\n          }\r\n            `}\r\n        </script>\r\n        <div\r\n          ref=\"screen\"\r\n          className=\"screen\"\r\n          onClick={this.onClick}\r\n          onDrop={this.onDrop}\r\n          onDragOver={this.onDragOver}\r\n        />\r\n        <input\r\n          ref=\"inputFile\"\r\n          type=\"file\"\r\n          accept=\".gb,.gba,.gbc,.zip\"\r\n          style={{\r\n            display: 'none',\r\n          }}\r\n          onChange={this.inputFileOnChange}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Emulator;\r\n\r\n","import React from 'react';\r\nimport dpadIcon from '../../images/dpad.svg';\r\n\r\nimport './Joystick.css';\r\n\r\nclass Joystick extends React.Component\r\n{\r\n  isPushed = false;\r\n\r\n  hasSupportTouch = ('ontouchstart' in document.documentElement);\r\n\r\n  constructor(props)\r\n  {\r\n    super(props);\r\n\r\n    this.selfRef = React.createRef();\r\n    this.emulatorRef = props.parent.emulatorRef;\r\n    this.emulatorManager = null;\r\n\r\n    this.onMouseDown = this.onMouseDown.bind(this);\r\n    this.onMouseMove = this.onMouseMove.bind(this);\r\n    this.onMouseUp = this.onMouseUp.bind(this);\r\n  }\r\n\r\n  componentDidMount()\r\n  {\r\n    this.emulatorManager = this.emulatorRef.current.emulatorManager;\r\n\r\n    const current = this.selfRef.current;\r\n\r\n    // Mouse\r\n    if (this.hasSupportTouch)\r\n    {\r\n      // window.addEventListener('touchstart', this.onMouseDown);\r\n      // window.addEventListener('touchend', this.onMouseUp);\r\n\r\n      current.addEventListener('touchstart', this.onMouseDown);\r\n      current.addEventListener('touchmove', this.onMouseMove);\r\n      current.addEventListener('touchend', this.onMouseUp);\r\n    }\r\n    else\r\n    {\r\n      // window.addEventListener('mousedown', this.onMouseDown);\r\n      window.addEventListener('mouseup', this.onMouseUp);\r\n\r\n      current.addEventListener('mousedown', this.onMouseDown);\r\n      current.addEventListener('mousemove', this.onMouseMove);\r\n      current.addEventListener('mouseup', this.onMouseUp);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount()\r\n  {\r\n    const current = this.selfRef.current;\r\n\r\n    current.removeEventListener('mousedown', this.onMouseDown);\r\n    current.removeEventListener('mousemove', this.onMouseMove);\r\n    current.removeEventListener('mouseup', this.onMouseUp);\r\n\r\n    current.removeEventListener('touchstart', this.onMouseDown);\r\n    current.removeEventListener('touchmove', this.onMouseMove);\r\n    current.removeEventListener('touchend', this.onMouseUp);\r\n    // current.removeEventListener('touchcancel', this.onMouseUp);\r\n\r\n    window.removeEventListener('mousedown', this.onMouseDown);\r\n    window.removeEventListener('mouseup', this.onMouseUp);\r\n    window.removeEventListener('touchstart', this.onMouseDown);\r\n    window.removeEventListener('touchend', this.onMouseUp);\r\n  }\r\n\r\n  onMouseDown(e)\r\n  {\r\n    console.log('%s', e.type, e);\r\n\r\n    const target = e.target;\r\n    const key = target.getAttribute('data-joykey');\r\n    if (!key)\r\n    {\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    this.isPushed = true;\r\n\r\n    if (this.emulatorManager.isKeyPressed(key))\r\n    {\r\n      return;\r\n    }\r\n\r\n    this.emulatorManager.onPressed(key);\r\n  }\r\n\r\n  onMouseMove(e)\r\n  {\r\n    console.log('%s', e.type);\r\n    if (!this.isPushed)\r\n    {\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n\r\n    let posX = e.clientX;\r\n    let posY = e.clientY;\r\n\r\n    if (e.type === 'touchmove')\r\n    {\r\n      // e.persist();\r\n      const touches = e.touches;\r\n\r\n      let touchedKeyList = [];\r\n      for (let i = 0; i < touches.length; i++)\r\n      {\r\n        const touch = touches[i];\r\n        const target = document.elementFromPoint(touch.clientX, touch.clientY);\r\n        if (!target)\r\n        {\r\n          continue;\r\n        }\r\n        const key = target.getAttribute('data-joykey');\r\n        if (!key || (key in touchedKeyList))\r\n        {\r\n          continue;\r\n        }\r\n        touchedKeyList.push(key);\r\n        // alert('pushed:' + key);\r\n      }\r\n\r\n      const pressedKeyList = this.emulatorManager.keyCodes;\r\n      const keys = Object.keys(pressedKeyList);\r\n      for (let i = 0; i < keys.length; i++)\r\n      {\r\n        const key = keys[i];\r\n        if (key in touchedKeyList)\r\n        {\r\n          continue;\r\n        }\r\n        if (!this.emulatorManager.isKeyPressed(key))\r\n        {\r\n          continue;\r\n        }\r\n        this.emulatorManager.onReleased(key);\r\n        // alert(key);\r\n      }\r\n\r\n      const changedTouches = e.changedTouches;\r\n      const touchPos = changedTouches[0];\r\n      posX = touchPos.clientX;\r\n      posY = touchPos.clientY;\r\n    }\r\n\r\n    const target = document.elementFromPoint(posX, posY);\r\n    if (!target)\r\n    {\r\n      return;\r\n    }\r\n    const key = target.getAttribute('data-joykey');\r\n    if (!key)\r\n    {\r\n      return;\r\n    }\r\n    if (this.emulatorManager.isKeyPressed(key))\r\n    {\r\n      return;\r\n    }\r\n    this.emulatorManager.onPressed(key);\r\n  }\r\n\r\n  onMouseUp(e)\r\n  {\r\n    console.log('%s', e.type, e);\r\n\r\n    // If all key released\r\n    if (!this.isPushed)\r\n    {\r\n      return;\r\n    }\r\n\r\n    this.isPushed = false;\r\n\r\n    // Because of one mouse only, so we release all\r\n    if (e.type === 'mouseup')\r\n    {\r\n      this.emulatorManager.releaseAllKey();\r\n      return;\r\n    }\r\n    else if (e.type === 'touchend')\r\n    {\r\n      if (e.touches.length <= 1)\r\n      {\r\n        this.emulatorManager.releaseAllKey();\r\n        return;\r\n      }\r\n    }\r\n\r\n    const target = e.target;\r\n    const key = target.getAttribute('data-joykey');\r\n    if (!key)\r\n    {\r\n      return;\r\n    }\r\n    this.emulatorManager.onReleased(key);\r\n  }\r\n\r\n  setActive(joykey, isActive)\r\n  {\r\n    const current = this.selfRef.current;\r\n    const btns = current.getElementsByTagName('button');\r\n    for (let i = 0; i < btns.length; i++)\r\n    {\r\n      const btn = btns[i];\r\n      if (!btn || btn.getAttribute('data-joykey') !== joykey)\r\n      {\r\n        continue;\r\n      }\r\n      if (isActive)\r\n      {\r\n        btn.classList.add('active');\r\n      }\r\n      else\r\n      {\r\n        btn.classList.remove('active');\r\n      }\r\n    }\r\n  }\r\n\r\n  render()\r\n  {\r\n    return (\r\n      <div ref={this.selfRef} className=\"joystick\">\r\n        <button className=\"rectangle-btn\" data-joykey=\"L\">\r\n          L\r\n        </button>\r\n        <button className=\"rectangle-btn\" data-joykey=\"R\">\r\n          R\r\n        </button>\r\n        <div\r\n          className=\"console-dpad-btn\"\r\n          style={{\r\n            backgroundImage: 'url('+dpadIcon+')',\r\n          }}\r\n        >\r\n          <button className=\"dpad-btn\" data-joykey=\"LEFT\"/>\r\n          <button className=\"dpad-btn\" data-joykey=\"UP\" />\r\n          <button className=\"dpad-btn\" data-joykey=\"RIGHT\" />\r\n          <button className=\"dpad-btn\" data-joykey=\"DOWN\" />\r\n        </div>\r\n        <button className=\"circle-btn\" data-joykey=\"A\">\r\n          A\r\n        </button>\r\n        <button className=\"circle-btn\" data-joykey=\"B\">\r\n          B\r\n        </button>\r\n        <button className=\"rectangle-btn\" data-joykey=\"START\">\r\n          Start\r\n        </button>\r\n        <button className=\"rectangle-btn\" data-joykey=\"SELECT\">\r\n          Select\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Joystick;\r\n\r\n","class GamepadManager\r\n{\r\n  gamepads = [];\r\n  rafId = null;\r\n  scanIntervalId = null;\r\n  selectedIndex = 0;\r\n\r\n  constructor(parent)\r\n  {\r\n    console.log('GamepadManager.constructor called');\r\n\r\n    this.parentRef = parent;\r\n\r\n    this.update = this.update.bind(this);\r\n    this.onGamepadConnected = this.onGamepadConnected.bind(this);\r\n    this.onGamepadDisconnected = this.onGamepadDisconnected.bind(this);\r\n    this.scanGamepads = this.scanGamepads.bind(this);\r\n  }\r\n\r\n  start()\r\n  {\r\n    window.addEventListener(\"gamepadconnected\", this.onGamepadConnected);\r\n    window.addEventListener(\"gamepaddisconnected\", this.onGamepadDisconnected);\r\n\r\n    this.scanIntervalId = setInterval(this.scanGamepads, 500);\r\n  }\r\n\r\n  destroy()\r\n  {\r\n    console.log('GamepadManager.destroy called');\r\n\r\n    window.removeEventListener(\"gamepadconnected\", this.onGamepadConnected);\r\n    window.removeEventListener(\"gamepaddisconnected\", this.onGamepadDisconnected);\r\n\r\n    window.cancelAnimationFrame(this.rafId);\r\n\r\n    clearInterval(this.scanIntervalId);\r\n  }\r\n\r\n  update()\r\n  {\r\n    console.log('GamepadManager.update called');\r\n\r\n    const gamepad = this.gamepads[this.selectedIndex];\r\n    console.log(gamepad);\r\n    for (let i = 0; i < gamepad.buttons.length; i++)\r\n    {\r\n      let val = gamepad.buttons[i];\r\n      let isPressed = (val === 1.0);\r\n      if (typeof(val) === 'object')\r\n      {\r\n        isPressed = val.pressed;\r\n        val = val.value;\r\n      }\r\n\r\n      console.log(val, isPressed);\r\n    }\r\n\r\n    // At end, loop\r\n    this.rafId = window.requestAnimationFrame(this.update);\r\n  }\r\n\r\n  scanGamepads()\r\n  {\r\n    console.log('GamepadManager.scanGamepads called');\r\n    let gamepads = navigator.getGamepads ? navigator.getGamepads() : [];\r\n    for (let i = 0; i < gamepads.length; i++)\r\n    {\r\n      if (!gamepads[i])\r\n      {\r\n        continue;\r\n      }\r\n\r\n      if (gamepads[i].index in this.gamepads)\r\n      {\r\n        this.gamepads[i] = gamepads[i];\r\n      }\r\n      else\r\n      {\r\n        this.addGamepad(gamepads[i]);\r\n      }\r\n    }\r\n  }\r\n\r\n  addGamepad(gamepad)\r\n  {\r\n    this.gamepads[gamepad.index] = gamepad;\r\n\r\n    this.rafId = window.requestAnimationFrame(this.update);\r\n    console.log('GamepadManager.start.id:' + this.rafId);\r\n  }\r\n\r\n  onGamepadConnected(e)\r\n  {\r\n    console.log(\"Gamepad connected at index %d: %s. %d buttons, %d axes.\",\r\n      e.gamepad.index, e.gamepad.id,\r\n      e.gamepad.buttons.length, e.gamepad.axes.length);\r\n  }\r\n\r\n  onGamepadDisconnected(e)\r\n  {\r\n    delete this.gamepads[e.gamepad.index];\r\n  }\r\n}\r\n\r\nexport default GamepadManager;\r\n\r\n","class KeyboardManager\r\n{\r\n  constructor(parent)\r\n  {\r\n    this.parent = parent;\r\n\r\n    this.onKeyDown = this.onKeyDown.bind(this);\r\n    this.onKeyUp = this.onKeyUp.bind(this);\r\n\r\n    this.keyMapConfig = {\r\n      A: 90,\r\n      B: 88,\r\n      SELECT: 83,\r\n      START: 65,\r\n      RIGHT: 39,\r\n      LEFT: 37,\r\n      UP: 38,\r\n      DOWN: 40,\r\n      R: 87,\r\n      L: 81,\r\n    };\r\n    this.pushedList = {};\r\n  }\r\n\r\n  start()\r\n  {\r\n    window.addEventListener(\"keydown\", this.onKeyDown);\r\n    window.addEventListener(\"keyup\", this.onKeyUp);\r\n\r\n    this.emulatorManager = this.parent.emulatorRef.current.emulatorManager;\r\n  }\r\n\r\n  destroy()\r\n  {\r\n    window.removeEventListener(\"keydown\", this.onKeyDown);\r\n    window.removeEventListener(\"keyup\", this.onKeyUp);\r\n  }\r\n\r\n  getJoykey(keyCode)\r\n  {\r\n    return Object.keys(this.keyMapConfig).find((elm) => {\r\n      return this.keyMapConfig[elm] === keyCode;\r\n    });\r\n  }\r\n\r\n  setActiveJoykey(keyType, isActive)\r\n  {\r\n    const joystickRef = this.parent.joystickRef.current;\r\n    joystickRef.setActive(keyType, isActive);\r\n  }\r\n\r\n  onKeyDown(e)\r\n  {\r\n    // console.log(e.keyCode);\r\n\r\n    const keyCode = e.keyCode;\r\n    if (this.pushedList[keyCode])\r\n    {\r\n      e.preventDefault();\r\n      return;\r\n    }\r\n\r\n    let keyType = this.getJoykey(keyCode);\r\n\r\n    if (!keyType)\r\n    {\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n\r\n    this.pushedList[keyCode] = true;\r\n\r\n    this.setActiveJoykey(keyType, true);\r\n\r\n    this.emulatorManager.onPressed(keyType);\r\n  }\r\n\r\n  onKeyUp(e)\r\n  {\r\n    // console.log(e);\r\n    const keyCode = e.keyCode;\r\n\r\n    let keyType = this.getJoykey(keyCode);\r\n\r\n    if (!keyType)\r\n    {\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n\r\n    this.pushedList[keyCode] = false;\r\n\r\n    this.setActiveJoykey(keyType, false);\r\n\r\n    this.emulatorManager.onReleased(keyType);\r\n  }\r\n}\r\n\r\nexport default KeyboardManager;\r\n\r\n","import React from 'react';\r\nimport BodyScrollUnAble from './BodyScrollUnAble';\r\n\r\nimport Emulator from './play/Emulator';\r\nimport Joystick from './play/Joystick';\r\nimport GamepadManager from './play/GamepadManager';\r\nimport KeyboardManager from './play/KeyboardManager';\r\n\r\nimport gbaLandscape from '../images/gba-console-landscape.svg';\r\nimport emuBKG from '../images/emu-background.svg';\r\n\r\nimport './Play.css';\r\n\r\nclass Play extends React.Component\r\n{\r\n  gamePadManager = null;\r\n\r\n  constructor(props)\r\n  {\r\n    console.log('Play.constructor called');\r\n\r\n    super(props);\r\n\r\n    this.selfRef = React.createRef();\r\n    this.joystickRef = React.createRef();\r\n    this.emulatorRef = React.createRef();\r\n\r\n    this.updateWindowDimensions = this.updateWindowDimensions.bind(this);\r\n\r\n    // Use Gamepad\r\n    if (window.getGamepads)\r\n    {\r\n      this.gamePadManager = new GamepadManager(this);\r\n    }\r\n    this.keyboardManager = new KeyboardManager(this);\r\n  }\r\n\r\n  componentDidMount()\r\n  {\r\n    this.updateWindowDimensions();\r\n    window.addEventListener('resize', this.updateWindowDimensions);\r\n    if (this.gamePadManager)\r\n    {\r\n      this.gamePadManager.start();\r\n    }\r\n    this.keyboardManager.start();\r\n  }\r\n\r\n  componentWillUnmount()\r\n  {\r\n    console.log('Play.componentWillUnmount');\r\n\r\n    window.removeEventListener('resize', this.updateWindowDimensions);\r\n\r\n    if (this.gamePadManager)\r\n    {\r\n      this.gamePadManager.destroy();\r\n    }\r\n    this.keyboardManager.destroy();\r\n  }\r\n\r\n  updateWindowDimensions()\r\n  {\r\n    console.log('updateWindowDimensions called');\r\n    let timeOut = setTimeout((() => {\r\n      clearTimeout(timeOut);\r\n      const current = this.selfRef.current;\r\n      if (window.innerWidth > window.innerHeight)\r\n      {\r\n        if (!current.classList.contains('landscape'))\r\n        {\r\n          current.classList.remove('portrait');\r\n          current.classList.add('landscape');\r\n          current.style.backgroundImage = 'url('+gbaLandscape+')';\r\n        }\r\n      }\r\n      else\r\n      {\r\n        if (!current.classList.contains('portrait'))\r\n        {\r\n          current.classList.remove('landscape');\r\n          current.classList.add('portrait');\r\n          current.style.backgroundImage = 'none';\r\n        }\r\n      }\r\n    }), 250);\r\n  }\r\n\r\n  render()\r\n  {\r\n    return (\r\n      <BodyScrollUnAble\r\n        style={{\r\n          backgroundImage: 'url('+emuBKG+')',\r\n        }}\r\n      >\r\n        <div\r\n          ref={this.selfRef}\r\n          className=\"play-wrapper\"\r\n        >\r\n          <Emulator\r\n            ref={this.emulatorRef}\r\n            parent={this}\r\n          />\r\n          <Joystick\r\n            ref={this.joystickRef}\r\n            parent={this}\r\n          />\r\n        </div>\r\n      </BodyScrollUnAble>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Play;\r\n\r\n","import React, { Component } from 'react';\r\nimport { Route } from 'react-router-dom';\r\nimport {\r\n  Layout\r\n} from 'antd';\r\n\r\nimport Home from './Home';\r\nimport Play from './Play';\r\n\r\nclass Main extends Component\r\n{\r\n  render()\r\n  {\r\n    return (\r\n      <Layout.Content>\r\n        <Route exact path=\"/\" component={Home} />\r\n        <Route exact path=\"/play\" component={Play} />\r\n      </Layout.Content>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Main;\r\n\r\n","import React, { Component } from 'react';\r\nimport { withRouter } from 'react-router-dom';\r\nimport { Layout } from 'antd';\r\n\r\nclass Footer extends Component\r\n{\r\n  render()\r\n  {\r\n    if (this.props.location.pathname === '/play')\r\n    {\r\n      return false;\r\n    }\r\n\r\n    return (\r\n      <Layout.Footer>\r\n      </Layout.Footer>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withRouter(Footer);\r\n\r\n","import React, { Component } from 'react';\r\nimport {\r\n  Layout\r\n} from 'antd';\r\n\r\nimport withSplashScreen from './components/withSplashScreen';\r\n\r\nimport Header from './components/Header';\r\nimport Main from './components/Main';\r\nimport Footer from './components/Footer';\r\nimport Sider from './components/Footer';\r\n\r\nimport './App.css';\r\nimport 'antd/dist/antd.css';\r\n\r\nclass App extends Component\r\n{\r\n  render()\r\n  {\r\n    return (\r\n      <Layout>\r\n        <Header />\r\n        <Layout>\r\n          <Sider />\r\n          <Main />\r\n        </Layout>\r\n        <Footer />\r\n      </Layout>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withSplashScreen(App);\r\n\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { BrowserRouter as Router } from 'react-router-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\n// Create AnimationFrame\r\nwindow.requestAnimationFrame = window.requestAnimationFrame ||\r\n    window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame ||\r\n    window.msRequestAnimationFrame;\r\n\r\nwindow.cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame;\r\n\r\nwindow.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n\r\nnavigator.getGamepads = navigator.getGamepads || navigator.webkitGamepads || navigator.webkitGetGamepads;\r\n\r\nReactDOM.render(\r\n  <Router basename={`${process.env.PUBLIC_URL}/#`}>\r\n    <App />\r\n  </Router>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n\r\n"],"sourceRoot":""}